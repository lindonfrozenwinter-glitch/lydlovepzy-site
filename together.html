<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘ä»¬çš„ç”œèœœæ—¶å…‰ - æˆ‘ä»¬ä¸€èµ·åš</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.3.2/pixi.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;400;500;700&family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Noto Serif SC', 'Inter', sans-serif;
        }
        
        .liquid-glass {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .romantic-gradient {
            background: linear-gradient(135deg, #FFB6C1 0%, #FFD700 50%, #FFA500 100%);
        }
        
        .sky-gradient {
            background: linear-gradient(135deg, #87CEEB 0%, #4682B4 50%, #191970 100%);
        }
        
        .dark-gradient {
            background: linear-gradient(135deg, #9370DB 0%, #4B0082 50%, #2F2F2F 100%);
        }
        
        .light-gradient {
            background: linear-gradient(135deg, #98FB98 0%, #32CD32 50%, #F5FFFA 100%);
        }
        
        .warm-gradient {
            background: linear-gradient(135deg, #FFA500 0%, #FF6347 50%, #FFF8DC 100%);
        }
        
        .floating-animation {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .task-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .task-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }
        
        .task-card.completed-by-none {
            background: rgba(128, 128, 128, 0.2);
            border-color: rgba(128, 128, 128, 0.3);
        }
        
        .task-card.completed-by-one {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 165, 0, 0.3));
            border-color: rgba(255, 215, 0, 0.5);
        }
        
        .task-card.completed-by-both {
            background: linear-gradient(135deg, rgba(255, 182, 193, 0.4), rgba(255, 215, 0, 0.4));
            border-color: rgba(255, 182, 193, 0.6);
        }
        
        .task-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .task-checkbox.checked {
            background: rgba(255, 215, 0, 0.8);
            border-color: rgba(255, 215, 0, 1);
            color: white;
        }
        
        .task-checkbox:hover {
            transform: scale(1.1);
        }
        
        .progress-ring {
            transform: rotate(-90deg);
        }
        
        .progress-ring-circle {
            transition: stroke-dashoffset 0.35s;
            transform-origin: 50% 50%;
        }
        
        .celebration-modal {
            background: radial-gradient(circle, rgba(255, 215, 0, 0.3) 0%, rgba(255, 182, 193, 0.3) 100%);
        }
        
        .nav-item {
            transition: all 0.3s ease;
            position: relative;
        }
        
        .nav-item:hover {
            transform: translateY(-2px);
        }
        
        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 3px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 2px;
        }
        
        .filter-btn {
            transition: all 0.3s ease;
        }
        
        .filter-btn:hover {
            transform: translateY(-2px);
        }
        
        .filter-btn.active {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        @keyframes celebrate {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(-5deg); }
            75% { transform: scale(1.1) rotate(5deg); }
        }
        
        .celebrate-animation {
            animation: celebrate 0.6s ease-in-out;
        }
        
        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #FFD700;
            border-radius: 50%;
            pointer-events: none;
        }
    </style>
</head>
<body class="min-h-screen transition-all duration-1000 romantic-gradient">
    <!-- å¯¼èˆªæ  -->
    <nav class="fixed top-0 left-0 right-0 z-50 liquid-glass mx-4 mt-4 px-6 py-4">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <h1 class="text-2xl font-bold text-white">ğŸ’• æˆ‘ä»¬çš„ç”œèœœæ—¶å…‰</h1>
                <span id="currentUser" class="text-white/80 text-sm"></span>
            </div>
            
            <div class="flex items-center space-x-6">
                <a href="main.html" class="nav-item text-white hover:text-white/80 font-medium">é¦–é¡µ</a>
                <a href="write.html" class="nav-item text-white hover:text-white/80 font-medium">å†™æ—¥å¸¸</a>
                <a href="together.html" class="nav-item active text-white hover:text-white/80 font-medium">æˆ‘ä»¬ä¸€èµ·åš</a>
                <a href="report.html" class="nav-item text-white hover:text-white/80 font-medium">ä¸€é”®æŠ¥å¤‡</a>
                <button id="logoutBtn" class="text-white/80 hover:text-white transition-colors">é€€å‡º</button>
            </div>
        </div>
    </nav>
    
    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="pt-24 pb-8 px-4">
        <div class="max-w-7xl mx-auto">
            <!-- æ ‡é¢˜åŒºåŸŸ -->
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold text-white mb-4 floating-animation">
                    æˆ‘ä»¬ä¸€èµ·åšçš„äº‹æƒ… ğŸ’‘
                </h2>
                <p class="text-white/80 text-lg">
                    å®Œæˆæ¯ä¸€ä¸ªå°ç›®æ ‡ï¼Œè®©æˆ‘ä»¬çš„çˆ±æƒ…æ›´åŠ ç”œèœœ
                </p>
            </div>
            
            <!-- è¿›åº¦ç»Ÿè®¡ -->
            <div class="liquid-glass p-6 mb-8">
                <div class="flex flex-col lg:flex-row items-center justify-between">
                    <div class="flex items-center space-x-8 mb-4 lg:mb-0">
                        <!-- è¿›åº¦ç¯ -->
                        <div class="relative">
                            <svg class="progress-ring w-24 h-24" viewBox="0 0 120 120">
                                <circle class="progress-ring-circle" 
                                        stroke="rgba(255, 255, 255, 0.3)" 
                                        stroke-width="8" 
                                        fill="transparent" 
                                        r="52" 
                                        cx="60" 
                                        cy="60"/>
                                <circle id="progressCircle"
                                        class="progress-ring-circle" 
                                        stroke="#FFD700" 
                                        stroke-width="8" 
                                        fill="transparent" 
                                        r="52" 
                                        cx="60" 
                                        cy="60"
                                        stroke-dasharray="326.73"
                                        stroke-dashoffset="326.73"/>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <span id="progressPercent" class="text-2xl font-bold text-white">0%</span>
                            </div>
                        </div>
                        
                        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                        <div class="text-white">
                            <div class="text-3xl font-bold mb-2">
                                <span id="completedCount">0</span> / <span id="totalCount">200</span>
                            </div>
                            <div class="text-white/80">å·²å®Œæˆä»»åŠ¡</div>
                            <div class="mt-2 text-sm">
                                <div>ç‹®ç‹å®Œæˆ: <span id="lionCount">0</span></div>
                                <div>å°é±¼å®Œæˆ: <span id="fishCount">0</span></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ç­›é€‰æŒ‰é’® -->
                    <div class="flex flex-wrap gap-2">
                        <button id="filterAll" class="filter-btn active px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg">
                            å…¨éƒ¨
                        </button>
                        <button id="filterNone" class="filter-btn px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg">
                            æœªå®Œæˆ
                        </button>
                        <button id="filterOne" class="filter-btn px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg">
                            ä¸€æ–¹å®Œæˆ
                        </button>
                        <button id="filterBoth" class="filter-btn px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg">
                            åŒæ–¹å®Œæˆ
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ä»»åŠ¡ç½‘æ ¼ -->
            <div id="taskGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- ä»»åŠ¡å¡ç‰‡å°†åŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <!-- åŠ è½½æ›´å¤šæç¤º -->
            <div id="loadingMessage" class="text-center py-8 text-white/60">
                <div class="text-2xl mb-2">ğŸ’•</div>
                <p>æ­£åœ¨åŠ è½½æ›´å¤šç”œèœœä»»åŠ¡...</p>
            </div>
        </div>
    </main>
    
    <!-- åº†ç¥å¼¹çª— -->
    <div id="celebrationModal" class="fixed inset-0 celebration-modal backdrop-blur-sm z-50 hidden flex items-center justify-center">
        <div class="liquid-glass p-8 max-w-md mx-4 text-center celebrate-animation">
            <div class="text-6xl mb-4">ğŸ‰</div>
            <h3 class="text-2xl font-bold text-white mb-4">æ­å–œæ­å–œï¼</h3>
            <p class="text-white/80 mb-6">æˆ‘ä»¬åˆä¸€èµ·åšäº†ä¸€ä»¶äº‹ï¼ğŸ’•</p>
            <p id="celebrationTask" class="text-white/90 font-medium mb-6"></p>
            <button onclick="closeCelebration()" 
                    class="px-6 py-3 bg-gradient-to-r from-pink-400 to-yellow-400 hover:from-pink-500 hover:to-yellow-500 text-white rounded-lg">
                ç»§ç»­åŠ æ²¹ ğŸ’ª
            </button>
        </div>
    </div>
    
    <script>
        // å…¨å±€å˜é‡
        let currentUser = '';
        let userIdentity = '';
        let coupleTasks = [];
        let currentFilter = 'all';
        
        // ç”¨æˆ·é…ç½®
        const userConfig = {
            'æ—ç²¤å†¬': { identity: 'ç‹®ç‹' },
            'è’²æŒ¯å®‡': { identity: 'å°é±¼' }
        };
        
        // 200ä¸ªæƒ…ä¾£ä»»åŠ¡æ¸…å•
        const defaultTasks = [
            "ä¸€èµ·çœ‹æ—¥å‡º", "ä¸€èµ·åšæ—©é¤", "ä¸€èµ·çœ‹ç”µå½±", "ä¸€èµ·æ•£æ­¥", "ä¸€èµ·åšé¥­",
            "ä¸€èµ·æ—…è¡Œ", "ä¸€èµ·æ‹ç…§", "ä¸€èµ·å”±æ­Œ", "ä¸€èµ·è·³èˆ", "ä¸€èµ·è¿åŠ¨",
            "ä¸€èµ·è¯»ä¹¦", "ä¸€èµ·ç”»ç”»", "ä¸€èµ·å†™æ—¥è®°", "ä¸€èµ·ç§æ¤ç‰©", "ä¸€èµ·å…»å® ç‰©",
            "ä¸€èµ·é€›è¡—", "ä¸€èµ·è´­ç‰©", "ä¸€èµ·å–å’–å•¡", "ä¸€èµ·å“èŒ¶", "ä¸€èµ·å–é…’",
            "ä¸€èµ·åšé¥­", "ä¸€èµ·çƒ˜ç„™", "ä¸€èµ·é‡é¤", "ä¸€èµ·éœ²è¥", "ä¸€èµ·çœ‹æ˜Ÿæ˜Ÿ",
            "ä¸€èµ·èµæœˆ", "ä¸€èµ·å¬é›¨", "ä¸€èµ·èµé›ª", "ä¸€èµ·å †é›ªäºº", "ä¸€èµ·æ‰“é›ªä»—",
            "ä¸€èµ·æ¸¸æ³³", "ä¸€èµ·æ»‘é›ª", "ä¸€èµ·æ»‘å†°", "ä¸€èµ·éª‘è½¦", "ä¸€èµ·å¼€è½¦",
            "ä¸€èµ·åç«è½¦", "ä¸€èµ·åé£æœº", "ä¸€èµ·åèˆ¹", "ä¸€èµ·çˆ¬å±±", "ä¸€èµ·çœ‹æµ·",
            "ä¸€èµ·é’“é±¼", "ä¸€èµ·çƒ§çƒ¤", "ä¸€èµ·èšé¤", "ä¸€èµ·ç©æ¸¸æˆ", "ä¸€èµ·æ‹¼å›¾",
            "ä¸€èµ·ä¸‹æ£‹", "ä¸€èµ·æ‰“ç‰Œ", "ä¸€èµ·æ‰“éº»å°†", "ä¸€èµ·Kæ­Œ", "ä¸€èµ·è·³èˆ",
            "ä¸€èµ·å¥èº«", "ä¸€èµ·ç‘œä¼½", "ä¸€èµ·è·‘æ­¥", "ä¸€èµ·æ‰“çƒ", "ä¸€èµ·æ¸¸æ³³",
            "ä¸€èµ·éª‘è½¦", "ä¸€èµ·çˆ¬å±±", "ä¸€èµ·å¾’æ­¥", "ä¸€èµ·éœ²è¥", "ä¸€èµ·çœ‹æ¼”å”±ä¼š",
            "ä¸€èµ·çœ‹ç”µå½±é¦–æ˜ ", "ä¸€èµ·å‚åŠ èŠ‚æ—¥", "ä¸€èµ·åº†ç¥ç”Ÿæ—¥", "ä¸€èµ·è¿‡çºªå¿µæ—¥", "ä¸€èµ·è¿‡æƒ…äººèŠ‚",
            "ä¸€èµ·è¿‡åœ£è¯èŠ‚", "ä¸€èµ·è¿‡æ–°å¹´", "ä¸€èµ·è¿‡ä¸­ç§‹", "ä¸€èµ·è¿‡å›½åº†", "ä¸€èµ·è¿‡ç«¯åˆ",
            "ä¸€èµ·æ‰«å¢“", "ä¸€èµ·ç¥­ç¥–", "ä¸€èµ·æ‹œä½›", "ä¸€èµ·ç¥ˆç¦", "ä¸€èµ·è®¸æ„¿",
            "ä¸€èµ·æ”¾çƒŸèŠ±", "ä¸€èµ·æ”¾é­ç‚®", "ä¸€èµ·ç‚¹ç¯ç¬¼", "ä¸€èµ·çŒœç¯è°œ", "ä¸€èµ·èµæœˆ",
            "ä¸€èµ·åŒ…é¥ºå­", "ä¸€èµ·åŒ…ç²½å­", "ä¸€èµ·åšæœˆé¥¼", "ä¸€èµ·åšæ±¤åœ†", "ä¸€èµ·åšå¹´ç³•",
            "ä¸€èµ·åšè…Šå…«ç²¥", "ä¸€èµ·åšæ¸…æ˜æœ", "ä¸€èµ·åšé‡é˜³ç³•", "ä¸€èµ·åšå…ƒå®µ", "ä¸€èµ·åšæ˜¥å·",
            "ä¸€èµ·åšé¢æ¡", "ä¸€èµ·åšé¥ºå­", "ä¸€èµ·åšåŒ…å­", "ä¸€èµ·åšé¦’å¤´", "ä¸€èµ·åšèŠ±å·",
            "ä¸€èµ·åšè›‹ç³•", "ä¸€èµ·åšé¥¼å¹²", "ä¸€èµ·åšé¢åŒ…", "ä¸€èµ·åšæŠ«è¨", "ä¸€èµ·åšæ±‰å ¡",
            "ä¸€èµ·åšå¯¿å¸", "ä¸€èµ·åšæ‹‰é¢", "ä¸€èµ·åšç«é”…", "ä¸€èµ·åšçƒ§çƒ¤", "ä¸€èµ·åšéº»è¾£çƒ«",
            "ä¸€èµ·åšä¸²ä¸²é¦™", "ä¸€èµ·åšå†’èœ", "ä¸€èµ·åšæ°´ç…®é±¼", "ä¸€èµ·åšéº»å©†è±†è…", "ä¸€èµ·åšå®«ä¿é¸¡ä¸",
            "ä¸€èµ·åšç³–é†‹æ’éª¨", "ä¸€èµ·åšé±¼é¦™è‚‰ä¸", "ä¸€èµ·åšå›é”…è‚‰", "ä¸€èµ·åšæ°´ç…®è‚‰ç‰‡", "ä¸€èµ·åšå¤«å¦»è‚ºç‰‡",
            "ä¸€èµ·åšä¸œå¡è‚‰", "ä¸€èµ·åšå«èŠ±é¸¡", "ä¸€èµ·åšç™½åˆ‡é¸¡", "ä¸€èµ·åšç›ç„—é¸¡", "ä¸€èµ·åšçƒ§é¹…",
            "ä¸€èµ·åšçƒ¤é¸­", "ä¸€èµ·åšçƒ§è‚‰", "ä¸€èµ·åšå‰çƒ§", "ä¸€èµ·åšè…Šè‚ ", "ä¸€èµ·åšè…Šè‚‰",
            "ä¸€èµ·åšé¦™è‚ ", "ä¸€èµ·åšç«è…¿", "ä¸€èµ·åšåŸ¹æ ¹", "ä¸€èµ·åšç‰›æ’", "ä¸€èµ·åšç¾Šæ’",
            "ä¸€èµ·åšçŒªæ’", "ä¸€èµ·åšé¸¡æ’", "ä¸€èµ·åšé±¼æ’", "ä¸€èµ·åšè™¾", "ä¸€èµ·åšèŸ¹",
            "ä¸€èµ·åšè´ç±»", "ä¸€èµ·åšèºç±»", "ä¸€èµ·åšç« é±¼", "ä¸€èµ·åšé±¿é±¼", "ä¸€èµ·åšå¢¨é±¼",
            "ä¸€èµ·åšæµ·å¸¦", "ä¸€èµ·åšç´«èœ", "ä¸€èµ·åšæµ·è‹”", "ä¸€èµ·åšæµ·è—»", "ä¸€èµ·åšæµ·èœ‡",
            "ä¸€èµ·åšæµ·å‚", "ä¸€èµ·åšé²é±¼", "ä¸€èµ·åšé±¼ç¿…", "ä¸€èµ·åšç‡•çª", "ä¸€èµ·åšè™«è‰",
            "ä¸€èµ·åšäººå‚", "ä¸€èµ·åšé¹¿èŒ¸", "ä¸€èµ·åšçµèŠ", "ä¸€èµ·åšæ¸æ", "ä¸€èµ·åšå½“å½’",
            "ä¸€èµ·åšé»„èŠª", "ä¸€èµ·åšå…šå‚", "ä¸€èµ·åšæ²™å‚", "ä¸€èµ·åšè¥¿æ´‹å‚", "ä¸€èµ·åšå¤ªå­å‚",
            "ä¸€èµ·åšçº¢æ£", "ä¸€èµ·åšæ¡‚åœ†", "ä¸€èµ·åšè²å­", "ä¸€èµ·åšç™¾åˆ", "ä¸€èµ·åšé“¶è€³",
            "ä¸€èµ·åšæœ¨è€³", "ä¸€èµ·åšé¦™è‡", "ä¸€èµ·åšè˜‘è‡", "ä¸€èµ·åšé‡‘é’ˆè‡", "ä¸€èµ·åšæé²è‡",
            "ä¸€èµ·åšé¸¡è…¿è‡", "ä¸€èµ·åšèŒ¶æ ‘è‡", "ä¸€èµ·åšçŒ´å¤´è‡", "ä¸€èµ·åšæ¾èŒ¸", "ä¸€èµ·åšçµèŠå­¢",
            "ä¸€èµ·åšèœ‚èœœ", "ä¸€èµ·åšèœ‚ç‹æµ†", "ä¸€èµ·åšèœ‚èƒ¶", "ä¸€èµ·åšèŠ±ç²‰", "ä¸€èµ·åšèœ‚èœ¡",
            "ä¸€èµ·åšç‡•çª", "ä¸€èµ·åšé˜¿èƒ¶", "ä¸€èµ·åšé¹¿è§’èƒ¶", "ä¸€èµ·åšé¾Ÿæ¿èƒ¶", "ä¸€èµ·åšé³–ç”²èƒ¶",
            "ä¸€èµ·åšç‰¡è›", "ä¸€èµ·åšè›¤èœŠ", "ä¸€èµ·åšè›å­", "ä¸€èµ·åšèš¶å­", "ä¸€èµ·åšæ·¡èœ",
            "ä¸€èµ·åšå¹²è´", "ä¸€èµ·åšé±¼è‚š", "ä¸€èµ·åšé±¼å”‡", "ä¸€èµ·åšé±¼éª¨", "ä¸€èµ·åšé±¼çš®"
        ];
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            initializeTasks();
            renderTasks();
            updateProgress();
            initializeEventListeners();
        });
        
        // åˆå§‹åŒ–åº”ç”¨
        function initializeApp() {
            currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                window.location.href = 'index.html';
                return;
            }
            
            userIdentity = userConfig[currentUser].identity;
            document.getElementById('currentUser').textContent = `${currentUser} (${userIdentity})`;
            
            // è®¾ç½®é¡µé¢é…è‰²
            const savedScheme = localStorage.getItem('colorScheme') || 'romantic';
            applyColorScheme(savedScheme);
        }
        
        // åº”ç”¨é…è‰²æ–¹æ¡ˆ
        function applyColorScheme(scheme) {
            const body = document.body;
            body.className = body.className.replace(/\b\w+-gradient\b/g, '');
            body.classList.add(`${scheme}-gradient`);
        }
        
        // åˆå§‹åŒ–ä»»åŠ¡æ•°æ®
        function initializeTasks() {
            const savedTasks = localStorage.getItem('coupleTasks');
            
            if (savedTasks) {
                coupleTasks = JSON.parse(savedTasks);
            } else {
                // é¦–æ¬¡åˆå§‹åŒ–
                coupleTasks = defaultTasks.map((task, index) => ({
                    id: index + 1,
                    task: task,
                    completedBy: [],
                    isFullyCompleted: false
                }));
                localStorage.setItem('coupleTasks', JSON.stringify(coupleTasks));
            }
        }
        
        // æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨
        function renderTasks() {
            const taskGrid = document.getElementById('taskGrid');
            const loadingMessage = document.getElementById('loadingMessage');
            
            // æ ¹æ®ç­›é€‰æ¡ä»¶è¿‡æ»¤ä»»åŠ¡
            let filteredTasks = coupleTasks;
            if (currentFilter === 'none') {
                filteredTasks = coupleTasks.filter(task => task.completedBy.length === 0);
            } else if (currentFilter === 'one') {
                filteredTasks = coupleTasks.filter(task => task.completedBy.length === 1);
            } else if (currentFilter === 'both') {
                filteredTasks = coupleTasks.filter(task => task.completedBy.length === 2);
            }
            
            // åˆ†æ‰¹æ¸²æŸ“ä»¥æé«˜æ€§èƒ½
            taskGrid.innerHTML = '';
            loadingMessage.classList.remove('hidden');
            
            setTimeout(() => {
                taskGrid.innerHTML = filteredTasks.map(task => {
                    const isCompletedByUser = task.completedBy.includes(currentUser);
                    const completionClass = task.completedBy.length === 0 ? 'completed-by-none' :
                                           task.completedBy.length === 1 ? 'completed-by-one' :
                                           'completed-by-both';
                    
                    return `
                        <div class="task-card ${completionClass}" onclick="toggleTask(${task.id})">
                            <div class="flex items-start space-x-3">
                                <div class="task-checkbox ${isCompletedByUser ? 'checked' : ''}" onclick="event.stopPropagation()">
                                    ${isCompletedByUser ? 'âœ“' : ''}
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-white font-medium mb-2">${task.task}</h3>
                                    <div class="flex items-center space-x-2 text-sm text-white/70">
                                        <span>ğŸ¦ ${task.completedBy.includes('æ—ç²¤å†¬') ? 'âœ“' : 'â—‹'}</span>
                                        <span>ğŸŸ ${task.completedBy.includes('è’²æŒ¯å®‡') ? 'âœ“' : 'â—‹'}</span>
                                        <span class="ml-auto">
                                            ${task.completedBy.length === 0 ? 'æœªå¼€å§‹' :
                                              task.completedBy.length === 1 ? 'è¿›è¡Œä¸­' :
                                              'å·²å®Œæˆ'}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            ${task.isFullyCompleted ? '<div class="absolute top-2 right-2 text-yellow-400 text-lg">ğŸ’–</div>' : ''}
                        </div>
                    `;
                }).join('');
                
                loadingMessage.classList.add('hidden');
                
                // æ·»åŠ å…¥åœºåŠ¨ç”»
                anime({
                    targets: '.task-card',
                    scale: [0.8, 1],
                    opacity: [0, 1],
                    delay: anime.stagger(50),
                    duration: 600,
                    easing: 'easeOutElastic(1, .8)'
                });
            }, 500);
        }
        
        // åˆ‡æ¢ä»»åŠ¡å®ŒæˆçŠ¶æ€
        function toggleTask(taskId) {
            const task = coupleTasks.find(t => t.id === taskId);
            if (!task) return;
            
            const isCompleted = task.completedBy.includes(currentUser);
            
            if (isCompleted) {
                // å–æ¶ˆå®Œæˆ
                task.completedBy = task.completedBy.filter(user => user !== currentUser);
            } else {
                // æ ‡è®°å®Œæˆ
                task.completedBy.push(currentUser);
                
                // æ£€æŸ¥æ˜¯å¦åŒæ–¹éƒ½å®Œæˆ
                if (task.completedBy.length === 2) {
                    task.isFullyCompleted = true;
                    showCelebration(task.task);
                }
            }
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('coupleTasks', JSON.stringify(coupleTasks));
            
            // æ›´æ–°ç•Œé¢
            renderTasks();
            updateProgress();
        }
        
        // æ›´æ–°è¿›åº¦ç»Ÿè®¡
        function updateProgress() {
            const totalTasks = coupleTasks.length;
            const completedByBoth = coupleTasks.filter(task => task.completedBy.length === 2).length;
            const completedByLion = coupleTasks.filter(task => task.completedBy.includes('æ—ç²¤å†¬')).length;
            const completedByFish = coupleTasks.filter(task => task.completedBy.includes('è’²æŒ¯å®‡')).length;
            
            const progressPercent = Math.round((completedByBoth / totalTasks) * 100);
            
            // æ›´æ–°æ•°å­—
            document.getElementById('completedCount').textContent = completedByBoth;
            document.getElementById('totalCount').textContent = totalTasks;
            document.getElementById('lionCount').textContent = completedByLion;
            document.getElementById('fishCount').textContent = completedByFish;
            document.getElementById('progressPercent').textContent = progressPercent + '%';
            
            // æ›´æ–°è¿›åº¦ç¯
            const circle = document.getElementById('progressCircle');
            const circumference = 2 * Math.PI * 52;
            const offset = circumference - (progressPercent / 100) * circumference;
            circle.style.strokeDashoffset = offset;
            
            // è¿›åº¦ç¯åŠ¨ç”»
            anime({
                targets: '#progressCircle',
                strokeDashoffset: [circumference, offset],
                duration: 1000,
                easing: 'easeOutElastic(1, .8)'
            });
        }
        
        // æ˜¾ç¤ºåº†ç¥å¼¹çª—
        function showCelebration(taskName) {
            document.getElementById('celebrationTask').textContent = taskName;
            document.getElementById('celebrationModal').classList.remove('hidden');
            
            // åˆ›å»ºç²’å­æ•ˆæœ
            createParticles();
            
            // æ’­æ”¾åº†ç¥éŸ³æ•ˆ
            playCelebrationSound();
        }
        
        // å…³é—­åº†ç¥å¼¹çª—
        function closeCelebration() {
            document.getElementById('celebrationModal').classList.add('hidden');
            
            // æ¸…é™¤ç²’å­
            document.querySelectorAll('.particle').forEach(p => p.remove());
        }
        
        // åˆ›å»ºç²’å­æ•ˆæœ
        function createParticles() {
            const modal = document.getElementById('celebrationModal');
            
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                
                modal.appendChild(particle);
                
                // ç²’å­åŠ¨ç”»
                anime({
                    targets: particle,
                    translateX: (Math.random() - 0.5) * 200,
                    translateY: (Math.random() - 0.5) * 200,
                    scale: [1, 0],
                    opacity: [1, 0],
                    duration: 2000,
                    easing: 'easeOutQuad',
                    complete: () => particle.remove()
                });
            }
        }
        
        // æ’­æ”¾åº†ç¥éŸ³æ•ˆ
        function playCelebrationSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // æ’­æ”¾æ¬¢å¿«çš„æ—‹å¾‹
                const melody = [
                    { freq: 523.25, time: 0 },      // C5
                    { freq: 659.25, time: 0.1 },    // E5
                    { freq: 783.99, time: 0.2 },    // G5
                    { freq: 1046.50, time: 0.3 },   // C6
                    { freq: 783.99, time: 0.5 },    // G5
                    { freq: 659.25, time: 0.6 },    // E5
                    { freq: 523.25, time: 0.7 }     // C5
                ];
                
                melody.forEach(note => {
                    setTimeout(() => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.setValueAtTime(note.freq, audioContext.currentTime);
                        oscillator.type = 'sine';
                        
                        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                        
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.15);
                    }, note.time * 1000);
                });
            } catch (e) {
                console.log('Audio not supported');
            }
        }
        
        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
        function initializeEventListeners() {
            // é€€å‡ºç™»å½•
            document.getElementById('logoutBtn').addEventListener('click', logout);
            
            // ç­›é€‰æŒ‰é’®
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // æ›´æ–°ç­›é€‰çŠ¶æ€
                    currentFilter = this.id.replace('filter', '').toLowerCase();
                    renderTasks();
                });
            });
            
            // ç‚¹å‡»åº†ç¥å¼¹çª—èƒŒæ™¯å…³é—­
            document.getElementById('celebrationModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeCelebration();
                }
            });
        }
        
        // é€€å‡ºç™»å½•
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                localStorage.removeItem('currentUser');
                localStorage.removeItem('loginTime');
                window.location.href = 'index.html';
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„å…¥åœºåŠ¨ç”»
        anime({
            targets: '.liquid-glass',
            translateY: [50, 0],
            opacity: [0, 1],
            duration: 800,
            easing: 'easeOutElastic(1, .8)'
        });
    </script>
</body>
</html>